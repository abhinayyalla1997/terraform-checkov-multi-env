{"check_type": "terraform", "results": {"passed_checks": [{"check_id": "CKV_AWS_227", "bc_check_id": "BC_AWS_GENERAL_122", "check_name": "Ensure KMS key is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["is_enabled"]}, "code_block": [[5, "resource \"aws_kms_key\" \"this\" {\n"], [6, "  description             = \"KMS key for ${var.project} RDS in ${var.environment} environment\"\n"], [7, "  key_usage               = \"ENCRYPT_DECRYPT\"\n"], [8, "  customer_master_key_spec = \"SYMMETRIC_DEFAULT\"\n"], [9, "  enable_key_rotation     = true\n"], [10, "  rotation_period_in_days = 365\n"], [11, "\n"], [12, "  policy = jsonencode({\n"], [13, "    Version = \"2012-10-17\"\n"], [14, "    Id      = \"env-${var.environment}-cmk\"\n"], [15, "    Statement = [\n"], [16, "\n"], [17, "      # RDS\n"], [18, "      {\n"], [19, "        Sid    = \"AllowRDS\"\n"], [20, "        Effect = \"Allow\"\n"], [21, "        Principal = {\n"], [22, "          Service = \"rds.amazonaws.com\"\n"], [23, "        }\n"], [24, "        Action = [\n"], [25, "          \"kms:Encrypt\",\n"], [26, "          \"kms:Decrypt\",\n"], [27, "          \"kms:ReEncrypt*\",\n"], [28, "          \"kms:GenerateDataKey*\",\n"], [29, "          \"kms:CreateGrant\",\n"], [30, "          \"kms:DescribeKey\"\n"], [31, "        ]\n"], [32, "        Resource = \"*\"\n"], [33, "        Condition = {\n"], [34, "          StringEquals = {\n"], [35, "            \"kms:CallerAccount\" = data.aws_caller_identity.current.account_id\n"], [36, "            \"kms:ViaService\"    = \"rds.${data.aws_region.current.id}.amazonaws.com\"\n"], [37, "          }\n"], [38, "        }\n"], [39, "      },\n"], [40, "\n"], [41, "      # S3\n"], [42, "      {\n"], [43, "        Sid    = \"AllowS3\"\n"], [44, "        Effect = \"Allow\"\n"], [45, "        Principal = {\n"], [46, "          Service = \"s3.amazonaws.com\"\n"], [47, "        }\n"], [48, "        Action = [\n"], [49, "          \"kms:Encrypt\",\n"], [50, "          \"kms:Decrypt\",\n"], [51, "          \"kms:GenerateDataKey*\"\n"], [52, "        ]\n"], [53, "        Resource = \"*\"\n"], [54, "      },\n"], [55, "\n"], [56, "      # Secrets Manager\n"], [57, "      {\n"], [58, "        Sid    = \"AllowSecretsManager\"\n"], [59, "        Effect = \"Allow\"\n"], [60, "        Principal = {\n"], [61, "          Service = \"secretsmanager.amazonaws.com\"\n"], [62, "        }\n"], [63, "        Action = [\n"], [64, "          \"kms:Encrypt\",\n"], [65, "          \"kms:Decrypt\",\n"], [66, "          \"kms:GenerateDataKey*\"\n"], [67, "        ]\n"], [68, "        Resource = \"*\"\n"], [69, "      },\n"], [70, "\n"], [71, "      {\n"], [72, "        Sid    = \"AllowECR\"\n"], [73, "        Effect = \"Allow\"\n"], [74, "        Principal = {\n"], [75, "          Service = \"ecr.amazonaws.com\"\n"], [76, "        }\n"], [77, "        Action = [\n"], [78, "          \"kms:Encrypt\",\n"], [79, "          \"kms:Decrypt\",\n"], [80, "          \"kms:GenerateDataKey*\"\n"], [81, "        ]\n"], [82, "        Resource = \"*\"\n"], [83, "      },\n"], [84, "\n"], [85, "      # Root safety net\n"], [86, "      {\n"], [87, "        Sid    = \"EnableRootPermissions\"\n"], [88, "        Effect = \"Allow\"\n"], [89, "        Principal = {\n"], [90, "          AWS = \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\"\n"], [91, "        }\n"], [92, "        Action   = \"kms:*\"\n"], [93, "        Resource = \"*\"\n"], [94, "      }\n"], [95, "    ]\n"], [96, "  })\n"], [97, "\n"], [98, "\n"], [99, "  tags = {\n"], [100, "    Name        = \"${var.environment}-${var.project}-rds-kms\"\n"], [101, "    Environment = var.environment\n"], [102, "    Project     = var.project\n"], [103, "  }\n"], [104, "}\n"]], "file_path": "/../../modules/kms/main.tf", "file_abs_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/kms/main.tf", "repo_file_path": "/modules/kms/main.tf", "file_line_range": [5, 104], "resource": "module.kms.aws_kms_key.this", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyIsEnabled", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "dev-checkov-rds-kms", "Project": "checkov"}, "caller_file_path": "/main.tf", "caller_file_line_range": [95, 99], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-aws-key-management-service-kms-key-is-enabled", "details": [], "check_len": null, "definition_context_file_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/kms/main.tf", "breadcrumbs": {"policy": [{"type": "module", "name": "kms", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/kms/variables.tf", "module_connection": false}], "description": [{"type": "module", "name": "kms", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/kms/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "kms", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/kms/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "kms", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/kms/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "kms", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/kms/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "kms", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_130", "bc_check_id": "BC_AWS_NETWORKING_53", "check_name": "Ensure VPC subnets do not assign public IP by default", "check_result": {"result": "PASSED", "evaluated_keys": ["map_public_ip_on_launch"]}, "code_block": [[23, "resource \"aws_subnet\" \"public\" {\n"], [24, "  count = length(var.public_subnet_cidrs)\n"], [25, "\n"], [26, "  vpc_id                  = aws_vpc.this.id\n"], [27, "  cidr_block              = var.public_subnet_cidrs[count.index]\n"], [28, "  availability_zone       = data.aws_availability_zones.available.names[count.index]\n"], [29, "  map_public_ip_on_launch = false\n"], [30, "\n"], [31, "  tags = {\n"], [32, "    Name        = \"${var.environment}-public-${count.index + 1}\"\n"], [33, "    Environment = var.environment\n"], [34, "    Project     = var.project\n"], [35, "  }\n"], [36, "}\n"]], "file_path": "/../../modules/vpc/main.tf", "file_abs_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [23, 36], "resource": "module.vpc.aws_subnet.public", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SubnetPublicIP", "fixed_definition": null, "entity_tags": {"Environment": "var.environment", "Name": "${var.environment}-public-${count.index + 1}", "Project": "var.project"}, "caller_file_path": "/main.tf", "caller_file_line_range": [31, 51], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-vpc-subnets-do-not-assign-public-ip-by-default", "details": [], "check_len": null, "definition_context_file_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/vpc/main.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vpc", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "idx": 9, "source_module_object": null}]}}, {"check_id": "CKV_AWS_130", "bc_check_id": "BC_AWS_NETWORKING_53", "check_name": "Ensure VPC subnets do not assign public IP by default", "check_result": {"result": "PASSED", "evaluated_keys": ["map_public_ip_on_launch"]}, "code_block": [[39, "resource \"aws_subnet\" \"private\" {\n"], [40, "  count = length(var.private_subnet_cidrs)\n"], [41, "\n"], [42, "  vpc_id                  = aws_vpc.this.id\n"], [43, "  cidr_block              = var.private_subnet_cidrs[count.index]\n"], [44, "  availability_zone       = data.aws_availability_zones.available.names[count.index]\n"], [45, "  map_public_ip_on_launch = false\n"], [46, "\n"], [47, "  tags = {\n"], [48, "    Name        = \"${var.environment}-private-${count.index + 1}\"\n"], [49, "    Environment = var.environment\n"], [50, "    Project     = var.project\n"], [51, "  }\n"], [52, "}\n"]], "file_path": "/../../modules/vpc/main.tf", "file_abs_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [39, 52], "resource": "module.vpc.aws_subnet.private", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SubnetPublicIP", "fixed_definition": null, "entity_tags": {"Environment": "var.environment", "Name": "${var.environment}-private-${count.index + 1}", "Project": "var.project"}, "caller_file_path": "/main.tf", "caller_file_line_range": [31, 51], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-vpc-subnets-do-not-assign-public-ip-by-default", "details": [], "check_len": null, "definition_context_file_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/vpc/main.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vpc", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "idx": 9, "source_module_object": null}]}}, {"check_id": "CKV_AWS_20", "bc_check_id": "BC_AWS_S3_1", "check_name": "S3 Bucket has an ACL defined which allows public READ access.", "check_result": {"result": "PASSED", "entity": {"aws_s3_bucket": {"this": {"__end_line__": 9, "__start_line__": 1, "bucket": ["dev-checkov-s3"], "tags": [{"Environment": "dev", "Name": "dev-checkov-s3", "Project": "checkov"}], "__address__": "module.s3.aws_s3_bucket.this", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["resource_type", "access_control_policy", "acl", "access_control_policy/grant", "access_control_policy/grant/*/grantee/uri"]}, "code_block": [[1, "resource \"aws_s3_bucket\" \"this\" {\n"], [2, "  bucket = \"${var.environment}-${var.project}-s3\"\n"], [3, "\n"], [4, "  tags = {\n"], [5, "    Name        = \"${var.environment}-${var.project}-s3\"\n"], [6, "    Environment = var.environment\n"], [7, "    Project     = var.project\n"], [8, "  }\n"], [9, "}\n"]], "file_path": "/../../modules/s3/main.tf", "file_abs_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/main.tf", "repo_file_path": "/modules/s3/main.tf", "file_line_range": [1, 9], "resource": "module.s3.aws_s3_bucket.this", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "dev-checkov-s3", "Project": "checkov"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/s3-policies/s3-1-acl-read-permissions-everyone", "details": [], "check_len": null, "definition_context_file_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/main.tf", "breadcrumbs": {"tags.Project": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/variables.tf", "module_connection": false}], "bucket": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV_AWS_145", "bc_check_id": "BC_AWS_GENERAL_56", "check_name": "Ensure that S3 buckets are encrypted with KMS by default", "check_result": {"result": "PASSED", "entity": {"aws_s3_bucket": {"this": {"__end_line__": 9, "__start_line__": 1, "bucket": ["dev-checkov-s3"], "tags": [{"Environment": "dev", "Name": "dev-checkov-s3", "Project": "checkov"}], "__address__": "module.s3.aws_s3_bucket.this", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["resource_type", "rule/apply_server_side_encryption_by_default/sse_algorithm", "server_side_encryption_configuration/rule/apply_server_side_encryption_by_default/sse_algorithm"]}, "code_block": [[1, "resource \"aws_s3_bucket\" \"this\" {\n"], [2, "  bucket = \"${var.environment}-${var.project}-s3\"\n"], [3, "\n"], [4, "  tags = {\n"], [5, "    Name        = \"${var.environment}-${var.project}-s3\"\n"], [6, "    Environment = var.environment\n"], [7, "    Project     = var.project\n"], [8, "  }\n"], [9, "}\n"]], "file_path": "/../../modules/s3/main.tf", "file_abs_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/main.tf", "repo_file_path": "/modules/s3/main.tf", "file_line_range": [1, 9], "resource": "module.s3.aws_s3_bucket.this", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "dev-checkov-s3", "Project": "checkov"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-s3-buckets-are-encrypted-with-kms-by-default", "details": [], "check_len": null, "definition_context_file_path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/main.tf", "breadcrumbs": {"tags.Project": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/variables.tf", "module_connection": false}], "bucket": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/modules/s3/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "s3", "path": "/home/runner/work/terraform-checkov-multi-env/terraform-checkov-multi-env/env/Dev/main.tf", "idx": 12, "source_module_object": null}]}}], "failed_checks": [], "skipped_checks": [], "parsing_errors": []}, "summary": {"passed": 5, "failed": 0, "skipped": 0, "parsing_errors": 0, "resource_count": 21, "checkov_version": "3.2.497"}, "url": "Add an api key '--bc-api-key <api-key>' to see more detailed insights via https://bridgecrew.cloud"}